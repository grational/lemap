/*
 * This build file was auto generated by 'gigawatt'
 * @author d7392
 * @date 09-02-2018 10.06
 */

// [plugins] this block must be the first
plugins {
	// support for groovy
	id 'groovy'
	// support for the api keyword in the dependencies section
	id 'java-library'
	// required by jitpack
	id 'maven-publish'
	// finally! tag version is software version!
	id 'pl.allegro.tech.build.axion-release' version '1.13.9'
}

// [general] configuration
project.ext {
	groovyVersion       = '3.0.10'
	spockVersion        = '2.1-groovy-3.0'
	codenarcVersion     = '3.0.1'
	slf4jVersion        = '1.7.36'
	commonsTextVersion  = '1.9'
}

scmVersion {
	tag {
		prefix = 'release-'
	}
}

project.with {
	//project.name is set in the settings.gradle with rootProject.name
	group                 'it.grational'
	version               scmVersion.version
	description           "A collection of maps with peculiars matching functions"
}
// [crosscompile] source and target java version
allprojects {
	sourceCompatibility = '1.8'
	targetCompatibility = sourceCompatibility
}

repositories {
	mavenCentral()
}

dependencies {
	implementation (
		// Groovy language support
		"org.codehaus.groovy:groovy:$groovyVersion",
		// Slf4j dependencies
		"org.slf4j:slf4j-api:$slf4jVersion",
		// for a revised implementation of the Levenshtein strings' distance
		"org.apache.commons:commons-text:$commonsTextVersion"
	)

	// We use the awesome Spock testing and specification framework
	testImplementation (
		"org.spockframework:spock-core:$spockVersion"
	)
}

// [tasks] configuration //
tasks.withType(Test) {
	useJUnitPlatform()
	maxParallelForks = Runtime.runtime.availableProcessors() / 2
}
jar {
	dependsOn 'check'
}

check {
	dependsOn 'clean'
}

// [tasks] definition
task uniTest(type: Test) {
	description = 'unit tests task'
	exclude '**/*ISpec*'
	exclude '**/*FSpec*'
}
task intTest(type: Test) {
	description = 'integration tests task'
	exclude '**/*USpec*'
	exclude '**/*FSpec*'
}
task funTest(type: Test) {
	description = 'functional tests task'
	exclude '**/*USpec*'
	exclude '**/*ISpec*'
}
gradle.startParameter.excludedTaskNames += "uniTest"
gradle.startParameter.excludedTaskNames += "intTest"
gradle.startParameter.excludedTaskNames += "funTest"

// required to work with jitpack.io
publishing {
	publications {
		mavenJava(MavenPublication) {
			groupId = 'com.github.grational'
			artifactId = 'lemap'
			version = scmVersion.version // '0.5.0' (remove -SNAPSHOT for releases)

			from components.java
		}
	}
}

// vim: ft=groovy:fdm=indent
